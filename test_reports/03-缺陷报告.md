# 书海阁项目测试缺陷报告

## 测试执行摘要

- **测试日期**: 2025年5月20日
- **测试环境**: Java 17, Spring Boot 3.2.3, MySQL
- **测试版本**: v1.0
- **测试工具**: JUnit 5, Maven Surefire
- **总测试用例数**: 99
- **通过数**: 72
- **失败数**: 17
- **错误数**: 10
- **跳过数**: 0

## 缺陷汇总表

| 编号 | 所属模块 | 用例名/方法 | 缺陷描述 | 严重级别 | 状态 |
|------|---------|-------------|----------|---------|------|
| DEF-001 | 图书搜索 | testSearchBooks_TC_S02_titleKeywordTooLong | 期望抛出异常但未抛出 | 高 | 待修复 |
| DEF-002 | 图书搜索 | testSearchBooks_TC_S03_authorKeywordTooLong | 期望抛出异常但未抛出 | 高 | 待修复 |
| DEF-003 | 图书搜索 | testSearchBooks_TC_S04_sortTypeInvalid | 期望抛出异常但未抛出 | 高 | 待修复 |
| DEF-004 | 图书管理 | testAddBook_TCB02_标题为空 | 期望抛出异常但未抛出 | 高 | 待修复 |
| DEF-005 | 图书管理 | testAddBook_TCB03_标题超长 | 期望抛出异常但未抛出 | 高 | 待修复 |
| DEF-006 | 图书管理 | testAddBook_TCB04_作者超长 | 期望抛出异常但未抛出 | 高 | 待修复 |
| DEF-007 | 图书管理 | testAddBook_TCB05_分类为空 | 期望抛出异常但未抛出 | 高 | 待修复 |
| DEF-008 | 图书管理 | testAddBook_TCB06_价格为0 | 期望抛出异常但未抛出 | 高 | 待修复 |
| DEF-009 | 图书管理 | testAddBook_TCB07_价格超上限 | 期望抛出异常但未抛出 | 高 | 待修复 |
| DEF-010 | 图书管理 | testAddBook_TCB10_描述超长 | 期望抛出异常但未抛出 | 高 | 待修复 |
| DEF-011 | 收藏管理 | testAddFavorite_TC_F02_invalidUserId | 非法用户ID收藏返回true | 高 | 待修复 |
| DEF-012 | 收藏管理 | testAddFavorite_TC_F03_invalidBookId | 非法图书ID收藏返回true | 高 | 待修复 |
| DEF-013 | 收藏管理 | testGetAllUserFavorites_TCF_LT04_multiFavoriteOrder | 收藏顺序断言失败 | 中 | 待修复 |
| DEF-014 | 用户注册 | testRegister_TC_U02_usernameTooShort | 用户名过短注册未拦截 | 高 | 待修复 |
| DEF-015 | 用户注册 | testRegister_TC_U03_usernameTooLong | 用户名过长注册未拦截 | 高 | 待修复 |
| DEF-016 | 用户注册 | testRegister_TC_U05_passwordTooShort | 密码过短注册未拦截 | 高 | 待修复 |
| DEF-017 | 用户注册 | testRegister_TC_U06_passwordTooLong | 密码过长注册未拦截 | 高 | 待修复 |
| DEF-018 | 图书管理 | testGetBookDetail_TCB_SC03_authorNull | 插入book时author缺省导致数据库异常 | 高 | 待修复 |
| DEF-019 | 图书管理 | testGetBookDetail_TCB_DC03_bookNotNull | 插入book时author缺省导致数据库异常 | 高 | 待修复 |
| DEF-020 | 图书管理 | testGetBookDetail_TCB_DC05_authorNullOrEmpty | 插入book时author缺省导致数据库异常 | 高 | 待修复 |
| DEF-021 | 收藏管理 | testAddFavorite_TCF_SC01_invalidUserId | user_id缺省导致数据库异常 | 高 | 待修复 |
| DEF-022 | 收藏管理 | testAddFavorite_TCF_SC02_invalidBookId | book_id缺省导致数据库异常 | 高 | 待修复 |
| DEF-023 | 收藏管理 | testAddFavorite_TCF_CC01_userIdNull | user_id缺省导致数据库异常 | 高 | 待修复 |
| DEF-024 | 收藏管理 | testAddFavorite_TCF_CC03_bookIdNull | book_id缺省导致数据库异常 | 高 | 待修复 |
| DEF-025 | 收藏管理 | testAddFavorite_TCF_DC01_userOrBookIdNull | user_id缺省导致数据库异常 | 高 | 待修复 |
| DEF-026 | 收藏管理 | testAddFavorite_TCF_PC01_paramInvalidPath | user_id缺省导致数据库异常 | 高 | 待修复 |
| DEF-027 | 图书搜索 | testListAllBooksAndSortByFavoriteCount_TCS_LT06_nullField | name缺省导致数据库异常 | 高 | 待修复 |

## 详细缺陷报告

### DEF-001 ~ DEF-003: 图书搜索输入校验未生效
- **用例**: testSearchBooks_TC_S02_titleKeywordTooLong, testSearchBooks_TC_S03_authorKeywordTooLong, testSearchBooks_TC_S04_sortTypeInvalid
- **复现步骤**: 输入超长标题/作者或非法排序类型进行搜索
- **实际结果**: 未抛出异常，未提示输入错误
- **期望结果**: 应抛出异常并提示输入不合法
- **严重级别**: 高
- **建议**: 增加参数长度和合法性校验

### DEF-004 ~ DEF-010: 图书管理输入校验与边界处理缺失
- **用例**: testAddBook_TCB02_标题为空, testAddBook_TCB03_标题超长, testAddBook_TCB04_作者超长, testAddBook_TCB05_分类为空, testAddBook_TCB06_价格为0, testAddBook_TCB07_价格超上限, testAddBook_TCB10_描述超长
- **复现步骤**: 添加不合法字段的图书
- **实际结果**: 未抛出异常，或数据库异常
- **期望结果**: 应在业务层校验并抛出异常
- **严重级别**: 高
- **建议**: 补充所有字段的前置校验，避免依赖数据库约束

### DEF-011 ~ DEF-013, DEF-021 ~ DEF-026: 收藏管理参数校验与顺序问题
- **用例**: testAddFavorite_TC_F02_invalidUserId, testAddFavorite_TC_F03_invalidBookId, testGetAllUserFavorites_TCF_LT04_multiFavoriteOrder, 及相关user_id/book_id缺省用例
- **复现步骤**: 传入非法或缺省ID进行收藏
- **实际结果**: 返回true或数据库异常
- **期望结果**: 应校验ID有效性并返回false或抛出业务异常
- **严重级别**: 高/中
- **建议**: 增加ID有效性校验，保证数据完整性

### DEF-014 ~ DEF-017: 用户注册输入校验缺失
- **用例**: testRegister_TC_U02_usernameTooShort, testRegister_TC_U03_usernameTooLong, testRegister_TC_U05_passwordTooShort, testRegister_TC_U06_passwordTooLong
- **复现步骤**: 注册时输入不合法用户名或密码
- **实际结果**: 注册成功，未拦截
- **期望结果**: 应拦截并提示输入不合法
- **严重级别**: 高
- **建议**: 补充用户名、密码长度等校验

### DEF-018 ~ DEF-020: 图书管理author缺省导致数据库异常
- **用例**: testGetBookDetail_TCB_SC03_authorNull, testGetBookDetail_TCB_DC03_bookNotNull, testGetBookDetail_TCB_DC05_authorNullOrEmpty
- **复现步骤**: 插入author为null的图书
- **实际结果**: 数据库异常 Field 'author' doesn't have a default value
- **期望结果**: 应在业务层校验并提示
- **严重级别**: 高
- **建议**: 业务层补充author非空校验

### DEF-027: 图书搜索name缺省导致数据库异常
- **用例**: testListAllBooksAndSortByFavoriteCount_TCS_LT06_nullField
- **复现步骤**: 插入name为null的图书后搜索
- **实际结果**: 数据库异常 Field 'name' doesn't have a default value
- **期望结果**: 应在业务层校验并提示
- **严重级别**: 高
- **建议**: 业务层补充name非空校验

## 总结与建议

本次测试发现主要缺陷集中在**输入参数校验缺失**、**边界值处理不完善**、**依赖数据库约束而非业务层校验**、**部分断言与实际实现不符**。建议：

1. 在业务逻辑层补充所有字段的非空、长度、范围等校验，避免依赖数据库异常暴露给用户。
2. 对所有ID、关键参数进行有效性校验，防止非法数据写入。
3. 优化测试用例断言，确保与实际业务逻辑一致。
4. 增强异常处理，提供友好错误提示。
5. 定期回归测试，持续提升系统健壮性。

请开发团队尽快修复上述缺陷，提升系统质量。 